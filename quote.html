<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>SOS Mechanics Quote</title>

<style>
body { 
    margin:0; 
    padding:20px; 
    font-family:Arial,sans-serif; 
    background:#222; /* lighter dark grey */
    color:#E0E0E0;
}
h1 { 
    color:#39FF14; 
    font-size:28px; 
    border-bottom:3px solid #39FF14; 
    padding-bottom:8px;
}
.section { 
    border:1px solid #39FF14; 
    padding:15px; 
    margin-top:15px; 
    background:#333; /* lighter section background */
}
label { display:block; margin-top:10px; }
input, select { width:100%; padding:8px; margin-top:4px; background:#333; border:1px solid #39FF14; color:#fff; }
.checkbox { display:inline-block; margin-right:15px; }
#total { font-size:26px; font-weight:bold; margin-top:20px; color:#39FF14; text-align:center; }
button { width:100%; padding:12px; background:#39FF14; border:none; color:#000; font-size:18px; cursor:pointer; margin-top:15px; }
table { width:100%; border-collapse:collapse; margin-top:10px;}
th, td { border:1px solid #39FF14; padding:8px; text-align:left;}
th { background-color:#444; color:#39FF14;}
tr:nth-child(even){background:#2a2a2a;}
tr:nth-child(odd){background:#333;}
.small-note { font-size:12px; color:#AAA; }
</style>
</head>
<body>

<h1>SOS Mechanics – Quote Dashboard</h1>

<div class="section">
    <p id="currentDate"></p>
    <p id="currentTime"></p>
    <p id="currentLocation"></p>
</div>

<div class="section">
<label>Customer Name:
<input type="text" id="customerName" placeholder="Enter customer name"></label>

<label>Number Plate:
<input type="text" id="numberPlate" placeholder="Enter number plate"></label>

<label>Engine Size:
<select id="engineSize">
<option value="1.4">Up to 1.4L</option>
<option value="2.0">1.5 – 2.0L</option>
<option value="3.0">2.1 – 3.0L</option>
<option value="3.1">3.1L+</option>
</select></label>

<label>Job:
<select id="jobSelect">
<option value="" selected disabled>Select a job</option>
<option value="clutch_small">Clutch Replacement ≤2.0L</option>
<option value="clutch_large">Clutch Replacement >2.0L</option>
<option value="brake_pads">Brake Pads (per axle)</option>
<option value="brake_discs">Brake Discs Replacement</option>
<option value="oil_change">Engine Oil + Filter</option>
<option value="coolant_change">Coolant System Service</option>
<option value="spark_plugs">Spark Plugs Replacement</option>
<option value="ignition_coils">Ignition Coils Replacement</option>
<option value="battery">Battery / Alternator Service</option>
<option value="lights">Headlights / Bulb Work</option>
<option value="minor_gasket">Minor Oil Leak / Gasket</option>
<option value="diagnostics">Diagnostics / Fault Scan</option>
<option value="suspension">Suspension / Shock Work</option>
<option value="steering">Steering / Linkage Work</option>
<option value="exhaust">Exhaust / Muffler</option>
<option value="filters">Air / Fuel / Cabin Filter</option>
<option value="tyres">Tyre Fitting / Rotation</option>
<option value="wipers">Wiper Blades Replacement</option>
<option value="belts">Timing / Drive Belts</option>
<option value="hoses">Hose Replacement</option>
<option value="fuel_system">Fuel Pump / Injector Work</option>
<option value="transmission_fluid">Transmission Fluid Check</option>
<option value="coolant_sensor">Coolant Sensor / Housing</option>
<option value="oil_sensor">Oil Pressure Sensor</option>
<option value="adblue_reset">AdBlue / SCR Reset</option>
<option value="ecu_coding">ECU / Coding</option>
<option value="roadside_fix">Emergency Roadside Fix</option>
<option value="diagnostic_map">Real-Time Mapping</option>
<option value="inspection_light">Inspection Light</option>
<option value="lights_adjustment">Headlight Alignment</option>
<option value="fuel_filter">Fuel Filter Replacement</option>
<option value="brake_fluid">Brake Fluid Change</option>
<option value="clutch_fluid">Clutch Fluid Top-Up</option>
<option value="manual_adjustments">Minor Adjustments</option>
<option value="emergency_towing">Towing / Recovery</option>
<option value="wheel_alignment">Wheel Alignment</option>
<option value="diagnostic_reset">Fault Reset</option>
<option value="battery_check">Battery Health Check</option>
<option value="coolant_flush">Coolant Flush</option>
<option value="lights_upgrade">Lighting Upgrade</option>
</select></label>
</div>

<div class="section">
<span class="small-note">Price shown is labour only, plus parts if needed.</span>
<span class="checkbox">
<input type="checkbox" id="conditionsFactor"> Conditions Factor (+15%)
</span>
<span class="checkbox">
<input type="checkbox" id="emergency"> Emergency / Weekend (+25%)
</span>
<p class="small-note">Two mechanics used for speed — price remains based on job.</p>
</div>

<div id="total">Total: £0 (+ parts)</div>
<button id="downloadBtn">Download Quote PDF</button>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>
<script>
// Job data
const jobData = {
'clutch_small': {labour:300,notes:'Clutch ≤2.0L; fluids topped up.'},
'clutch_large': {labour:450,notes:'Clutch >2.0L; fluids topped up.'},
'brake_pads': {labour:75,notes:'Brake pads per axle.'},
'brake_discs': {labour:120,notes:'Brake discs per axle.'},
'oil_change': {labour:55,notes:'Oil & filter; fluids topped up.'},
'coolant_change': {labour:60,notes:'Coolant system check.'},
'spark_plugs': {labour:85,notes:'Spark plugs.'},
'ignition_coils': {labour:85,notes:'Ignition coils.'},
'battery': {labour:120,notes:'Battery/alternator.'},
'lights': {labour:40,notes:'Bulbs & lighting.'},
'minor_gasket': {labour:85,notes:'Minor oil leak.'},
'diagnostics': {labour:50,notes:'Diagnostics & fault scan.'},
'suspension': {labour:150,notes:'Suspension checks.'},
'steering': {labour:120,notes:'Steering/links.'},
'exhaust': {labour:100,notes:'Exhaust/muffler.'},
'filters': {labour:35,notes:'Filter replacements.'},
'tyres': {labour:50,notes:'Tyre rotation/fitting.'},
'wipers': {labour:20,notes:'Wiper blades.'},
'belts': {labour:100,notes:'Belts replacement.'},
'hoses': {labour:60,notes:'Hose work.'},
'fuel_system': {labour:120,notes:'Fuel system.'},
'transmission_fluid': {labour:55,notes:'Trans fluid check.'},
'coolant_sensor': {labour:60,notes:'Coolant sensor.'},
'oil_sensor': {labour:55,notes:'Oil sensor.'},
'adblue_reset': {labour:50,notes:'AdBlue reset.'},
'ecu_coding': {labour:80,notes:'ECU coding.'},
'roadside_fix': {labour:100,notes:'Roadside fix.'},
'diagnostic_map': {labour:60,notes:'Real-time mapping.'},
'inspection_light': {labour:40,notes:'Inspection light.'},
'lights_adjustment': {labour:35,notes:'Lights alignment.'},
'fuel_filter': {labour:50,notes:'Fuel filter.'},
'brake_fluid': {labour:45,notes:'Brake fluid.'},
'clutch_fluid': {labour:40,notes:'Clutch fluid.'},
'manual_adjustments': {labour:30,notes:'Minor adjustments.'},
'emergency_towing': {labour:150,notes:'Towing assistance.'},
'wheel_alignment': {labour:90,notes:'Wheel alignment.'},
'diagnostic_reset': {labour:40,notes:'Diagnostic reset.'},
'battery_check': {labour:35,notes:'Battery health check.'},
'coolant_flush': {labour:60,notes:'Coolant flush.'},
'lights_upgrade': {labour:70,notes:'Lighting upgrade.'}
};

// Total calculation
function updateTotal(){
    let jobKey = document.getElementById('jobSelect').value;
    if(!jobKey){ // no job selected
        document.getElementById('total').innerText = 'Total: £0 (+ parts)';
        return;
    }
    let cond = document.getElementById('conditionsFactor').checked;
    let emerg = document.getElementById('emergency').checked;
    let job = jobData[jobKey];
    let total = job.labour; // always labour base
    if(cond) total *= 1.15;
    if(emerg) total *= 1.25;
    document.getElementById('total').innerText = 'Total: £'+total.toFixed(2)+' (+ parts)';
}
document.getElementById('jobSelect').addEventListener('change',updateTotal);
document.getElementById('conditionsFactor').addEventListener('change',updateTotal);
document.getElementById('emergency').addEventListener('change',updateTotal);

// Auto date/time
function showDateTime(){
    let n=new Date();
    document.getElementById('currentDate').innerText='Date: '+n.toLocaleDateString();
    document.getElementById('currentTime').innerText='Time: '+n.toLocaleTimeString();
}
showDateTime();

// Auto location
if(navigator.geolocation){
    navigator.geolocation.getCurrentPosition(pos=>{
        document.getElementById('currentLocation').innerText=
        `Location: ${pos.coords.latitude.toFixed(4)}, ${pos.coords.longitude.toFixed(4)}`;
    },()=>{document.getElementById('currentLocation').innerText='Location: Not available';});
}else document.getElementById('currentLocation').innerText='Location: Not supported';

// Auto apply conditions/emergency based on time/day
function autoApplyRates() {
    const now = new Date();
    const hour = now.getHours();
    const day = now.getDay(); // 0=Sunday,6=Saturday
    const condCheckbox=document.getElementById('conditionsFactor');
    const emergCheckbox=document.getElementById('emergency');
    condCheckbox.checked=(hour>=18 || hour<7);
    emergCheckbox.checked=(day===0 || day===6 || hour<8 || hour>18);
    updateTotal();
}
autoApplyRates();
setInterval(autoApplyRates,60000);

// PDF Download
document.getElementById('downloadBtn').addEventListener('click',()=>{
    const { jsPDF } = window.jspdf;
    let doc=new jsPDF();
    let cust=document.getElementById('customerName').value||'N/A';
    let plate=document.getElementById('numberPlate').value||'N/A';
    let jobKey=document.getElementById('jobSelect').value;
    if(!jobKey) { alert('Please select a job first'); return; }
    let job=jobData[jobKey];
    let cond=document.getElementById('conditionsFactor').checked;
    let emerg=document.getElementById('emergency').checked;
    let total=job.labour;
    if(cond) total*=1.15;
    if(emerg) total*=1.25;

    doc.setFontSize(14);
    doc.text('SOS Mechanics – Quote',20,20);
    doc.setFontSize(10);
    doc.text(`Date: ${new Date().toLocaleDateString()}`,20,30);
    doc.text(`Time: ${new Date().toLocaleTimeString()}`,20,36);
    doc.text(`Customer: ${cust}`,20,42);
    doc.text(`Number Plate: ${plate}`,20,48);
    doc.text(`Location: ${document.getElementById('currentLocation').innerText}`,20,54);

    doc.autoTable({
        startY:60,
        head:[['Job','Labour (£)','Notes']],
        body:[[jobKey.replace(/_/g,' ').toUpperCase(),job.labour.toFixed(2),job.notes]],
        theme:'grid',
        headStyles:{fillColor:[57,255,20], textColor:[0,0,0]},
        styles:{fontSize:8}
    });

    doc.text(`Total: £${total.toFixed(2)} (+ parts)`,20,doc.lastAutoTable.finalY+10);
    doc.save(`SOS_Quote_${plate}_${new Date().toISOString().slice(0,10)}.pdf`);
});
</script>
</body>
</html>