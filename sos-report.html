<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>SOS Mobile Report</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<style>
:root {
  --accent: #39ff14;
  --text: #111;
  --muted: #666;
}

body {
  font-family: system-ui, sans-serif;
  background: #fff;
  color: var(--text);
  margin:0;
  padding-top:64px;
}

/* Header */
header {
  position: fixed;
  top:0;
  left:0;
  width:100%;
  display:flex;
  justify-content:space-between;
  align-items:center;
  padding:16px 16px; /* flush mobile padding */
  border-bottom:1px solid #eee;
  background:#fff;
  z-index:1000;
}

header .logo img {
  height:40px;
  max-width:60%;
}

.hamburger {
  display:none;
  font-size:1.5rem;
  cursor:pointer;
}

nav#menu {
  display:flex;
  gap:16px;
}

nav#menu a {
  text-decoration:none;
  color:var(--text);
  font-weight:600;
}

nav#menu a.current {
  color:var(--accent);
  text-shadow:0 0 8px var(--accent);
}

/* Container and form fields */
.container {
  max-width:720px;
  margin:auto;
  padding:32px;
}

label {font-weight:600; display:block; margin-bottom:6px;}
input, select, textarea {width:100%; padding:10px; border-radius:6px; border:1px solid #ccc; box-sizing:border-box;}
textarea {min-height:90px;}
button {background:var(--accent); border:none; padding:12px; font-weight:700; border-radius:8px; cursor:pointer;}
img.preview {width:100%; margin-top:10px; border-radius:6px;}
footer {font-size:0.75rem; color:var(--muted); margin-top:48px;}
h3 {margin-top:24px;}

/* Mobile adjustments */
@media(max-width:768px){
  .hamburger {display:block;}
  
  nav#menu {
    display:none;
    flex-direction:column;
    width:100%;
    position:absolute;
    top:64px;
    left:0;
    background:#fff;
    border-top:1px solid #eee;
    padding:0;
    margin:0;
  }

  nav#menu a {
    padding:14px 16px; /* full width tap area */
    border-bottom:1px solid #eee;
    display:block;
  }

  nav#menu.active {display:flex;}

  /* Full width mobile with assistance form spacing */
  .container {
    width:100%;
    padding:20px;
    margin:0;
  }

  section {margin-bottom:24px;}
  label {margin-bottom:6px; display:block; font-weight:600;}
  input, select, textarea, button {
    width:100%;
    box-sizing:border-box;
    padding:12px;
    margin-bottom:12px;
    font-size:0.95rem;
  }

  h3 {margin-top:20px; margin-bottom:12px; font-size:1.1rem;}
  img.preview {width:100%; max-width:100%; margin-top:10px; border-radius:6px;}
  button {padding:14px; font-size:1rem; border-radius:8px;}
}
</style>
</head>
<body>

<header>
  <div class="logo"><img src="assets/logo.png" alt="SOS Mechanics"></div>
  <div class="hamburger" onclick="toggleMenu()">☰</div>
  <nav id="menu">
    <a href="index.html">Home</a>
    <a href="sosmobilereports.html" class="current">Get Report</a>
  </nav>
</header>

<main class="container">
<h2>SOS Mobile Diagnostic Report</h2>
<small>This report was generated by SOS Mobile Reports</small>

<section>
  <label>Number Plate</label>
  <input id="plate" placeholder="ABC1234">
  <label>Vehicle</label>
  <input id="vehicle" placeholder="BMW 118i">
  <label>Report Type</label>
  <select id="type" onchange="toggleFull()">
    <option value="quick">Quick Check</option>
    <option value="full">Full Diagnostic</option>
  </select>
</section>

<section id="complaints">
  <h3>Customer Complaints</h3>
  <label>1.</label><input type="text" id="complaint1" placeholder="First complaint">
  <label>2.</label><input type="text" id="complaint2" placeholder="Second complaint">
  <label>3.</label><input type="text" id="complaint3" placeholder="Third complaint">
</section>

<section id="battery">
  <h3>Battery & Electrical Check</h3>
  <label>Battery OK?</label>
  <select id="battery-quick">
    <option value="Yes">Yes</option>
    <option value="No">No</option>
  </select>

  <div id="battery-full">
    <label>Battery Voltage (V)</label>
    <input type="number" id="battery-voltage" step="0.1" placeholder="12.5">
    <label>Battery Health (%)</label>
    <input type="number" id="battery-health" step="1" placeholder="80">
    <label>Jump Start Required?</label>
    <select id="battery-jump">
      <option value="No">No</option>
      <option value="Yes">Yes</option>
    </select>
    <label>Crank Voltage (V)</label>
    <input type="number" id="crank-voltage" step="0.1" placeholder="10.5">
    <label>Alternator Voltage (V)</label>
    <input type="number" id="alternator-voltage" step="0.1" placeholder="14.2">
    <label>Notes</label>
    <textarea id="battery-notes"></textarea>
  </div>
</section>

<section id="physical">
  <h3>Physical Checks</h3>
  <label>Brakes OK?</label>
  <select id="brakes-quick">
    <option value="Yes">Yes</option>
    <option value="No">No</option>
  </select>
  <div id="physical-full">
    <label>Brakes / Pads / Fluid Notes</label><textarea id="brakes-notes"></textarea>
    <label>Engine Notes</label><textarea id="engine-notes"></textarea>
    <label>Lights / Dashboard Notes</label><textarea id="lights-notes"></textarea>
  </div>
</section>

<section id="location">
  <h3>Vehicle Location</h3>
  <button type="button" onclick="getLocation()">Get GPS Location</button>
  <label>Or enter manually:</label>
  <input type="text" id="manual-location" placeholder="Latitude, Longitude">
</section>

<section>
  <label>Observations</label>
  <textarea id="obs"></textarea>
</section>

<section id="live-section">
  <label>Live Data / ECU Codes</label>
  <textarea id="live"></textarea>
</section>

<section>
  <label>Recommendations</label>
  <textarea id="rec"></textarea>
</section>

<section>
  <label>Add Photos</label>
  <input type="file" accept="image/*" multiple onchange="previewImages(event)">
  <div id="previews"></div>
</section>

<section>
  <button onclick="generatePDF()">Download PDF Report</button>
</section>

<footer>
This report reflects vehicle condition at the time of inspection only. Findings are based on checks performed and do not guarantee future outcomes.
</footer>
</main>

<script>
let images = [];
let locationCoords = "";
function toggleMenu(){document.getElementById("menu").classList.toggle("active");}
function previewImages(event){
  const files = event.target.files;
  const previews = document.getElementById("previews");
  previews.innerHTML=""; images=[];
  for(let file of files){
    const reader = new FileReader();
    reader.onload = e=>{
      images.push(e.target.result);
      const img = document.createElement("img"); img.src=e.target.result; img.className="preview";
      previews.appendChild(img);
    };
    reader.readAsDataURL(file);
  }
}
function toggleFull(){
  const full = document.getElementById("type").value==="full";
  document.getElementById("battery-full").style.display = full?"block":"none";
  document.getElementById("physical-full").style.display = full?"block":"none";
  document.getElementById("live-section").style.display = full?"block":"none";
}
toggleFull();

function getLocation(){
  if(navigator.geolocation){
    navigator.geolocation.getCurrentPosition(
      (pos)=>{
        const {latitude, longitude} = pos.coords;
        locationCoords = `${latitude.toFixed(6)}, ${longitude.toFixed(6)}`;
        document.getElementById("manual-location").value = locationCoords;
        alert("Location captured automatically!");
      },
      ()=>{alert("Unable to get GPS. Enter manually.");}
    );
  } else {alert("Geolocation not supported. Enter manually.");}
}

async function generatePDF(){
  const { jsPDF } = window.jspdf;
  const pdf = new jsPDF();
  const plate=document.getElementById("plate").value;
  const vehicle=document.getElementById("vehicle").value;
  const type=document.getElementById("type").value;
  const obs=document.getElementById("obs").value;
  const live=document.getElementById("live").value;
  const rec=document.getElementById("rec").value;
  const c1=document.getElementById("complaint1").value;
  const c2=document.getElementById("complaint2").value;
  const c3=document.getElementById("complaint3").value;
  const batteryQuick=document.getElementById("battery-quick").value;
  const batteryVoltage=document.getElementById("battery-voltage").value;
  const batteryHealth=document.getElementById("battery-health").value;
  const batteryJump=document.getElementById("battery-jump").value;
  const crankVoltage=document.getElementById("crank-voltage").value;
  const alternatorVoltage=document.getElementById("alternator-voltage").value;
  const batteryNotes=document.getElementById("battery-notes").value;
  const brakesQuick=document.getElementById("brakes-quick").value;
  const brakesNotes=document.getElementById("brakes-notes").value;
  const engineNotes=document.getElementById("engine-notes").value;
  const lightsNotes=document.getElementById("lights-notes").value;
  const manualLocation=document.getElementById("manual-location").value;

  let y=10;
  pdf.setFontSize(14);
  pdf.text(`Vehicle Report – ${plate}`,10,y); y+=8;
  pdf.setFontSize(10);
  pdf.text(`Type: ${type}`,10,y); y+=6;
  pdf.text(`Vehicle: ${vehicle}`,10,y); y+=6;
  pdf.text(`Date: ${new Date().toLocaleString()}`,10,y); y+=10;
  pdf.text(`Location: ${manualLocation||"Not Provided"}`,10,y); y+=10;

  pdf.setFontSize(11);
  pdf.text("Customer Complaints:",10,y); y+=6;
  pdf.setFontSize(10);
  pdf.text(`1. ${c1||"-"}`,10,y); y+=6;
  pdf.text(`2. ${c2||"-"}`,10,y); y+=6;
  pdf.text(`3. ${c3||"-"}`,10,y); y+=10;

  pdf.setFontSize(11);
  pdf.text("Battery & Electrical Check:",10,y); y+=6;
  pdf.setFontSize(10);
  if(type==="quick"){
    pdf.text(`Battery OK? ${batteryQuick}`,10,y); y+=6;
    pdf.text(`Brakes OK? ${brakesQuick}`,10,y); y+=6;
  } else {
    pdf.text(`Battery Voltage: ${batteryVoltage||"-"}`,10,y); y+=6;
    pdf.text(`Battery Health: ${batteryHealth||"-"}%`,10,y); y+=6;
    pdf.text(`Jump Start Required: ${batteryJump}`,10,y); y+=6;
    pdf.text(`Crank Voltage: ${crankVoltage||"-"}`,10,y); y+=6;
    pdf.text(`Alternator Voltage: ${alternatorVoltage||"-"}`,10,y); y+=6;
    pdf.text(`Notes: ${batteryNotes||"-"}`,10,y,{maxWidth:180}); y+=6;
    pdf.text("Physical Checks:",10,y); y+=6;
    pdf.text(`Brakes Notes: ${brakesNotes||"-"}`,10,y,{maxWidth:180}); y+=6;
    pdf.text(`Engine Notes: ${engineNotes||"-"}`,10,y,{maxWidth:180}); y+=6;
    pdf.text(`Lights Notes: ${lightsNotes||"-"}`,10,y,{maxWidth:180}); y+=6;
    pdf.text("Live Data / ECU Codes:",10,y); y+=6;
    pdf.text(live||"-",10,y,{maxWidth:180}); y+=10;
  }

  pdf.text("Observations:",10,y); y+=6;
  pdf.text(obs||"-",10,y,{maxWidth:180}); y+=10;
  pdf.text("Recommendations:",10,y); y+=6;
  pdf.text(rec||"-",10,y,{maxWidth:180}); y+=10;

  for(let img of images){
    pdf.addPage();
    const imgProps = pdf.getImageProperties(img);
    const pdfWidth = 180;
    const pdfHeight = (imgProps.height * pdfWidth) / imgProps.width;
    pdf.addImage(img,"JPEG",10,20,pdfWidth,pdfHeight);
  }

  pdf.setFontSize(7);
  pdf.text("Disclaimer: This report reflects the condition of the vehicle at the time of inspection only. Fixes cannot be guaranteed.",10,280);
  pdf.save(`SOS_Report_${plate}.pdf`);
}
</script>

</body>
</html>