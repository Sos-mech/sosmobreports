<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>SOS Mechanics – Customer Consent</title>

<style>
body {
  margin: 0;
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Arial, sans-serif;
  background: #f6f7f8;
  color: #111;
}

header {
  background: #ffffff;
  padding: 16px;
  display: flex;
  align-items: center;
  gap: 12px;
  border-bottom: 2px solid #00e676;
}

header img {
  height: 42px;
}

header h1 {
  font-size: 1.05em;
  margin: 0;
  font-weight: 600;
}

.container {
  max-width: 560px;
  margin: auto;
  padding: 20px;
}

.card {
  background: #ffffff;
  border-radius: 14px;
  padding: 20px;
  box-shadow: 0 8px 20px rgba(0,0,0,0.08);
  margin-bottom: 16px;
}

.card h2 {
  margin-top: 0;
  font-size: 1em;
  color: #00b85c;
}

label {
  display: block;
  margin-top: 14px;
  font-weight: 600;
  font-size: 0.85em;
}

input {
  width: 100%;
  padding: 12px;
  margin-top: 6px;
  font-size: 0.95em;
  border-radius: 10px;
  border: 2px solid #ddd;
  background: #fff;
}

input.invalid {
  border-color: #e53935;
}

button {
  width: 100%;
  margin-top: 20px;
  padding: 18px;
  font-size: 1em;
  font-weight: 600;
  border-radius: 30px;
  border: none;
  background: linear-gradient(135deg, #00ff7f, #00e676);
  color: #000;
  opacity: 0.5;
}

button.enabled {
  opacity: 1;
}

.footer {
  text-align: center;
  font-size: 0.75em;
  color: #777;
  padding: 24px 10px;
}
</style>
</head>

<body>

<header>
  <img src="assets/logo.png" alt="SOS Mechanics">
  <h1>Customer Consent & Authorisation</h1>
</header>

<div class="container">

  <div class="card">
    <h2>Customer-Initiated Request</h2>
    <p>
      The diagnostic or repair work on this vehicle has been <strong>requested by the customer</strong>.  
      No actions or recommendations are taken without the customer’s explicit instruction.
    </p>
  </div>

  <div class="card">
    <h2>Liability & Authority</h2>
    <p>
      The customer confirms they have the legal authority to authorise work on this vehicle.  
      All information provided is accurate.  
      SOS Mechanics is not liable for misinformation or undisclosed facts.  
      Police may be contacted immediately if safety or conduct issues arise.
    </p>
  </div>

  <div class="card">
    <h2>Customer Details</h2>
    <label>Full Name (type to consent)</label>
    <input type="text" id="custName" placeholder="Your full name">
  </div>

  <button id="agreeBtn" disabled>AGREE & AUTHORISE WORK</button>

</div>

<div class="footer">
  SOS Mechanics · Mobile Mechanic Consent Record · Date, Time & Location captured
</div>

<script>
const nameInput = document.getElementById("custName");
const agreeBtn = document.getElementById("agreeBtn");

nameInput.addEventListener("input", () => {
  if(nameInput.value.trim().length > 0){
    agreeBtn.disabled = false;
    agreeBtn.classList.add("enabled");
  } else {
    agreeBtn.disabled = true;
    agreeBtn.classList.remove("enabled");
  }
});

agreeBtn.addEventListener("click", () => {
  const name = nameInput.value.trim();
  const now = new Date().toLocaleString();
  let location = "Unavailable";

  if(navigator.geolocation){
    navigator.geolocation.getCurrentPosition(
      pos => {
        location = `Lat ${pos.coords.latitude.toFixed(6)}, Lon ${pos.coords.longitude.toFixed(6)}`;
        savePDF(name, now, location);
      },
      () => savePDF(name, now, location)
    );
  } else {
    savePDF(name, now, location);
  }
});

function savePDF(name, now, location){
  const { jsPDF } = window.jspdf || {};
  if(!jsPDF){
    alert("jsPDF library required to save PDF");
    return;
  }
  const pdf = new jsPDF();
  const jobRef = `SOSCONSENT-${name.replace(/\s+/g,'').toUpperCase()}-${Date.now().toString().slice(-6)}`;

  pdf.text(`
SOS MECHANICS – CUSTOMER CONSENT & AUTHORISATION

Job Reference: ${jobRef}
Customer Name: ${name}
Date & Time: ${now}
Location: ${location}

The customer has requested diagnostic/repair work and authorises SOS Mechanics to proceed.
All liability excluded for misinformation. Police may be contacted for conduct issues.
`, 10, 10);

  pdf.save(`${jobRef}.pdf`);
  alert(`Consent recorded.\nJob Ref: ${jobRef}\nPDF downloaded.`);
}
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

</body>
</html>