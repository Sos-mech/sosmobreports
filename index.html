<!DOCTYPE html>
<html lang="en-GB">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SOS Mechanics | Medway Mobile Booking 2026</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script defer src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;800&display=swap" rel="stylesheet">
    
    <style>
        [x-cloak] { display: none !important; }
        body { font-family: 'Plus Jakarta Sans', sans-serif; background-color: #0c0819; color: #ffffff; overflow-x: hidden; }
        .airline-card { background: rgba(255, 255, 255, 0.03); backdrop-filter: blur(12px); border: 1px solid rgba(255, 255, 255, 0.1); transition: all 0.3s ease; }
        .airline-card:hover { border-color: #9333ea; background: rgba(255, 255, 255, 0.05); }
        .glass-input { background: rgba(255, 255, 255, 0.05); border: 1px solid rgba(255, 255, 255, 0.2); color: white; transition: all 0.3s ease; }
        .glass-input:focus { border-color: #9333ea; box-shadow: 0 0 0 4px rgba(147, 51, 234, 0.3); outline: none; }
        @keyframes pulse-purple { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }
        .locating { animation: pulse-purple 1.5s infinite; }
        
        /* Ensures buttons don't show on the actual printed paper */
        @media print { 
            .no-print { display: none !important; } 
            body { background: white !important; color: black !important; }
            .shadow-2xl { box-shadow: none !important; }
            .rounded-\[2\.5rem\] { border-radius: 0 !important; }
        }
    </style>
</head>

<body x-data="{ 
    step: 1, 
    confirmed: false,
    name: '',
    reg: '', 
    postcode: '', 
    isLocating: false,
    locStatus: 'Use Precise Location',
    bookingRef: '',
    timestamp: '',
    cart: [],
    
    majorJobs: {
        'Clutch Replacement': 895,
        'Full Engine Service & MOT': 349,
        'Gearbox Repair (Mobile)': 1200
    },
    smallerJobs: {
        'Mobile Brake Overhaul': 420,
        'Suspension Spring Replacement': 185,
        'EV Priority Service': 210
    },
    minorJobs: {
        'Emergency Diagnostics': 125,
        'Battery Replacement': 95,
        'Puncture Repair': 65
    },

    getAllServices() {
        return { ...this.majorJobs, ...this.smallerJobs, ...this.minorJobs };
    },

    getTotal() { 
        let all = this.getAllServices();
        return this.cart.reduce((sum, item) => sum + (all[item] || 0), 0); 
    },

    addToCart(item) { if (!this.cart.includes(item)) this.cart.push(item); },
    removeItem(item) { this.cart = this.cart.filter(i => i !== item); },
    
    resetBooking() {
        this.step = 1;
        this.confirmed = false;
        this.cart = [];
        this.name = '';
        this.reg = '';
        this.postcode = '';
        window.scrollTo({ top: 0, behavior: 'smooth' });
    },

    async getLocation() {
        if (!navigator.geolocation) return;
        this.isLocating = true;
        this.locStatus = 'Locating...';
        navigator.geolocation.getCurrentPosition(async (pos) => {
            try {
                const res = await fetch(`https://api.postcodes.io/postcodes?lon=${pos.coords.longitude}&lat=${pos.coords.latitude}`);
                const data = await res.json();
                if (data.result) this.postcode = data.result[0].postcode;
                this.locStatus = 'Location Found';
            } catch { this.locStatus = 'Error'; }
            finally { this.isLocating = false; }
        });
    },

    confirmBooking() {
        this.bookingRef = 'SOS-' + Math.random().toString(36).substr(2, 7).toUpperCase();
        this.timestamp = new Date().toLocaleString('en-GB', { dateStyle: 'full', timeStyle: 'short' });
        this.confirmed = true;
        window.scrollTo({ top: 0, behavior: 'smooth' });
    }
}" x-cloak>

    <header class="w-full bg-[#130d2b] border-b border-white/5 sticky top-0 z-50 no-print">
        <nav class="max-w-6xl mx-auto px-6 flex justify-between items-center h-20">
            <div class="text-xl font-black tracking-tighter uppercase">
                <span class="text-purple-500 italic">SOS</span> Mechanics
            </div>
            <div class="text-[10px] font-bold text-purple-400 bg-purple-400/10 px-3 py-1 rounded-full border border-purple-400/20 uppercase">2026 Fleet</div>
        </nav>
    </header>

    <main class="max-w-6xl mx-auto p-4 md:p-6 mt-4">
        
        <!-- STEP-BY-STEP FLOW -->
        <div x-show="!confirmed" class="flex flex-col lg:flex-row gap-8 lg:gap-12">
            <div class="flex-1 space-y-10">
                
                <section x-show="step === 1" class="airline-card rounded-3xl p-8">
                    <h1 class="text-3xl font-extrabold mb-6 italic">Passenger Check-in</h1>
                    <input type="text" x-model="name" placeholder="Full Name" class="glass-input w-full p-5 rounded-2xl text-xl font-semibold mb-6">
                    <button @click="if(name) step = 2" class="w-full bg-purple-600 py-5 rounded-2xl font-black tracking-widest">CONTINUE</button>
                </section>

                <section x-show="step === 2" class="airline-card rounded-3xl p-8">
                    <h2 class="text-3xl font-extrabold mb-6 italic">Vehicle Manifest</h2>
                    <input type="text" x-model="reg" placeholder="ENTER REG" class="glass-input w-full text-center text-3xl font-black py-6 rounded-2xl uppercase mb-6 tracking-widest">
                    <input type="text" x-model="postcode" placeholder="POSTCODE" class="glass-input w-full p-5 rounded-2xl mb-6">
                    <div class="flex gap-4">
                        <button @click="step = 1" class="flex-1 bg-white/5 py-5 rounded-2xl font-bold">Back</button>
                        <button @click="if(reg && postcode) step = 3" class="flex-[2] bg-purple-600 py-5 rounded-2xl font-black">NEXT</button>
                    </div>
                </section>

                <section x-show="step === 3" class="space-y-10">
                    <div>
                        <h2 class="text-xs font-black text-purple-400 uppercase tracking-[0.3em] mb-4">Class I: Major Operations</h2>
                        <div class="grid gap-3">
                            <template x-for="(price, item) in majorJobs">
                                <button @click="addToCart(item)" class="airline-card p-5 rounded-2xl flex justify-between items-center">
                                    <span class="font-bold text-lg" x-text="item"></span>
                                    <span class="text-xl font-black" x-text="'£' + price"></span>
                                </button>
                            </template>
                        </div>
                    </div>

                    <div>
                        <h2 class="text-xs font-black text-gray-400 uppercase tracking-[0.3em] mb-4">Class II: Smaller Jobs</h2>
                        <div class="grid gap-3">
                            <template x-for="(price, item) in smallerJobs">
                                <button @click="addToCart(item)" class="airline-card p-4 rounded-xl flex justify-between items-center border-dashed">
                                    <span class="font-semibold text-gray-200" x-text="item"></span>
                                    <span class="font-bold" x-text="'£' + price"></span>
                                </button>
                            </template>
                        </div>
                    </div>

                    <div>
                        <h2 class="text-xs font-black text-gray-600 uppercase tracking-[0.3em] mb-4">Class III: Minor Jobs</h2>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
                            <template x-for="(price, item) in minorJobs">
                                <button @click="addToCart(item)" class="airline-card p-3 rounded-lg flex justify-between items-center text-xs">
                                    <span x-text="item"></span>
                                    <span class="font-bold" x-text="'£' + price"></span>
                                </button>
                            </template>
                        </div>
                    </div>
                </section>
            </div>

            <aside class="w-full lg:w-96">
                <div class="bg-white text-[#0c0819] rounded-3xl overflow-hidden shadow-2xl p-8 sticky top-28">
                    <p class="text-[10px] font-black uppercase text-gray-400 mb-6">Live Itinerary</p>
                    <div class="min-h-[60px] mb-6">
                        <template x-for="s in cart">
                            <div class="flex justify-between items-center mb-3 text-sm font-bold border-b border-gray-50 pb-2">
                                <span x-text="s"></span>
                                <button @click="removeItem(s)" class="text-red-500 text-[10px]">X</button>
                            </div>
                        </template>
                    </div>
                    <button @click="getLocation()" class="w-full mb-4 bg-gray-50 text-[10px] font-black py-4 rounded-xl uppercase tracking-widest" :class="isLocating ? 'locating' : ''" x-text="locStatus"></button>
                    <div class="flex justify-between items-center mb-6">
                        <span class="text-xs font-bold uppercase text-gray-400">Total</span>
                        <span class="text-3xl font-black" x-text="'£' + getTotal()"></span>
                    </div>
                    <button @click="confirmBooking()" class="w-full bg-black text-white font-black py-5 rounded-xl tracking-widest disabled:opacity-20 transition-transform active:scale-95" :disabled="!name || !reg || cart.length === 0">CONFIRM DEPLOYMENT</button>
                </div>
            </aside>
        </div>

        <!-- FINAL TICKET SUMMARY (FULL) -->
        <div x-show="confirmed" x-transition class="max-w-3xl mx-auto pb-12">
            <div class="bg-white text-[#0c0819] rounded-[2.5rem] shadow-2xl overflow-hidden border border-gray-100">
                
                <!-- Ticket Header -->
                <div class="bg-purple-600 p-8 md:p-12 text-white flex flex-col md:flex-row justify-between items-start gap-8 md:gap-0">
                    <div>
                        <h1 class="text-3xl md:text-5xl font-black tracking-tighter mb-2 uppercase italic">Deployment Active</h1>
                        <p class="text-purple-200 font-bold uppercase tracking-[0.2em] text-[10px]">SOS Mechanics Priority Fleet • Medway Unit</p>
                    </div>
                    <div class="text-left md:text-right w-full md:w-auto">
                        <p class="text-[9px] font-black opacity-70 uppercase mb-2 tracking-widest">Booking Reference</p>
                        <div class="inline-block transform -rotate-3 md:-rotate-12 bg-white/10 px-5 py-2 rounded-lg border border-white/30">
                            <p class="font-mono font-bold text-sm md:text-lg text-white tracking-[0.3em]" x-text="bookingRef"></p>
                        </div>
                    </div>
                </div>

                <div class="p-8 md:p-12 space-y-10">
                    <!-- Passenger/Vehicle/Zone Info -->
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6 pb-10 border-b border-gray-100">
                        <div class="bg-gray-50 p-5 rounded-2xl">
                            <p class="text-[9px] font-bold text-gray-400 uppercase mb-1">Passenger</p>
                            <p class="font-black text-lg" x-text="name"></p>
                        </div>
                        <div class="bg-gray-50 p-5 rounded-2xl border-l-4 border-purple-500">
                            <p class="text-[9px] font-bold text-gray-400 uppercase mb-1">Vehicle</p>
                            <p class="font-black text-lg" x-text="reg"></p>
                        </div>
                        <div class="bg-gray-50 p-5 rounded-2xl">
                            <p class="text-[9px] font-bold text-gray-400 uppercase mb-1">Medway Zone</p>
                            <p class="font-black text-lg uppercase" x-text="postcode"></p>
                        </div>
                    </div>

                    <!-- Service Manifest Breakdown -->
                    <div>
                        <p class="text-[10px] font-black text-gray-400 uppercase tracking-widest mb-6">Deployment Manifest</p>
                        <div class="space-y-4">
                            <template x-for="item in cart">
                                <div class="flex justify-between items-center text-sm md:text-base border-b border-gray-50 pb-3">
                                    <span class="font-bold text-gray-800 uppercase italic text-xs md:text-sm" x-text="item"></span>
                                    <span class="font-mono font-bold text-purple-600" x-text="'£' + getAllServices()[item]"></span>
                                </div>
                            </template>
                            
                            <div class="flex flex-col md:flex-row justify-between items-start md:items-center pt-8 border-t-2 border-black mt-6 gap-4">
                                <span class="font-black text-2xl italic uppercase block">Total Charge Paid</span>
                                <span class="text-4xl md:text-5xl font-black text-purple-600" x-text="'£' + getTotal()"></span>
                            </div>
                        </div>
                    </div>

                    <!-- Metadata -->
                    <div class="bg-[#f8f9ff] rounded-[2rem] p-6 flex flex-col md:flex-row justify-between items-center gap-6 border border-purple-100">
                        <div>
                            <p class="text-[10px] font-bold text-gray-400 uppercase mb-1">Timestamp</p>
                            <p class="text-xs font-bold" x-text="timestamp"></p